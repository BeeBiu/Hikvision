# Hikvision
基于海康威视SDK实现的重启、关机、预览、录像工具

![image](https://github.com/BeeBiu/Hikvision/blob/d794a9c1421ee9333e99d22c272a2d4f0bc0eaed/1.jpg)

2025年6月最蠢记事，原本好好用的，非要折腾固件，把摄像机折腾残废了（海康威视5.6.0这个固件刷完之后，网络存储功能只会写入第一个文件夹，不会继续往下写，也就是说循环写入功能开启时录像只能保存在datadir0文件夹，datadir0文件夹大概80G，不管多大硬盘，只能用到80G，这种大BUG居然还放官网给人升级）

买了个新的发现海康威视最新的固件(V5.9.0)把NAS网络存储功能，也就是挂载NFS、SMB的功能删除掉了，只能插TF卡或者连他们自家的云2.0协议 （气死了，原本摄像头也就3W左右功率，录像直接保存到nas里也不浪费硬盘，现在额外加一个10W的录像机和一块硬盘）
然后我发现海康自家把老的存储服务器软件给下架了，彻底断绝windows server上软件录像的可能性

实在没办法买了他们家的录像机，发现依然存在很多小问题，比如移动侦测时间错乱，要么丢画面要么画面变化少就没录进去，等于完全失去移动侦测功能，只能开全天录像，目前不知道是摄像机的固件问题还是录像机性能不够

最后发现海康威视居然提供了SDK，看了下文档开发难度不高就试了一下，写了这个软件
<br>
<br>
<br>
软件主要是为了实现 （关机） 这个功能

因为海康威视自家的录像机居然不提供关机操作，必须连显示器，才提供关机，无法通过远程控制关机，因此考虑到硬盘健康，实现了SDK里的关机接口
需要注意的是，关机后必须插拔电源线才行，如果下发关机指令后无法断电，就尴尬了

其余功能比如预览和录像都是附带实现的，优点是纯绿色软件

关于录像功能，因为频繁扫盘比较吃性能，需要自行调整切片文件大小和容量限制参数，假如100G的空间，限制要限制到90G，同时软件删除功能写的比较简单，超过设定容量才触发删除操作
删除逻辑是，每15分钟扫文件夹统计每个文件容量，然后对比限制大小，超过了就删除时间最早的那个文件

需要注意的情况是 容量溢出的几种可能<br>
1、如果要删除的文件被占用，导致删除失败，文件没有实际删除，那么会在下一个15分钟重新触发，如果文件一直删不掉软件不会主动停止<br>
2、如果码率过高，导致15分钟删一次的文件容量小于切片大小，就会导致来不及删，这时需要调整切片文件大小，也就是说先录30分钟，看文件多大，然后切片单文件大小不能小于这个值，即可<br>
3、注意单位，容量限制是GB，切片是MB，单位是不一样的<br>

录像功能就是采集摄像头实时预览的流，这部分是SDK自带的接口，并不是我写的程序在控制录像文件生成，功耗肯定比10W录像机要节能得多，多少还是吃点CPU资源的，稳定性自然也不如录像机，不要在生产环境使用，万一断网啥的中断了是没有重连和报警功能的
同时录像是不支持在摄像机里查看回放的，也就是说摄像机是无法连上这个软件保存的录像的，这个软件只是采集，不能完全替代录像机

网上没有找到 云2.0 的文档，海康自家的协议不懂怎么实现，如果能实现这个功能才是最完美的
